EmployeeModule.controller("AdminController", ["$scope", "$http", "EmployeeFactory", function ($scope, $http, EmployeeFactory) {

    $scope.alertdanger = true;
    $scope.alertsuccess = true;

    $scope.GetState = function () {
        $scope.FetchStateDetiles = [];

        EmployeeFactory.PostServiceCall(urlpro + '/GetState/').then(function (response) {
            for (i = 0; i < response.data.length; ++i) {
                $scope.FetchStateDetiles.push(response.data[i]);
            }
        });
    }

    $scope.GetPosition = function () {
        $scope.FetchPositionDetiles = [];

        EmployeeFactory.PostServiceCall(urlpro + '/GetPosition/').then(function (response) {
            for (i = 0; i < response.data.length; ++i) {
                $scope.FetchPositionDetiles.push(response.data[i]);
            }
        });
    }

    $scope.SubmitData = function () {
        debugger;
        var chkuser = CheckUsernamesAvailability();
        debugger;
        if (chkuser == 0) {

            $scope.tempSaveArray = [];
            var oUsername = $scope.ngUsername;
            var oName = $scope.ngName;
            var oJoiningDate = $("#start_date").val();
            var oPosition = $scope.ngPosition;
            var oFatherName = $scope.ngFatherName;
            var oDOB = $("#end_date").val();
            var oState = $scope.ngState;
            var oAddress = $scope.ngAddress;
            var oMobileNo = $scope.ngMobileNo;
            var oGender = $scope.ngGender;
            var oEmail = $scope.ngEmail;
            var oPostcode = $scope.ngPostcode;
            var oReporting = $scope.ngReporting;
            var oUserLevel = $scope.ngUserLevel;
            var oPassword = $scope.ngPassword;
            var CWRData = {
                Username: oUsername,
                Name: oName,
                JoiningDate: oJoiningDate,
                Position: oPosition,//$scope.ngPosition,
                FatherName: oFatherName,
                DOB: oDOB,
                Address: oAddress,
                MobileNo: oMobileNo,
                Gender: oGender,
                Email: oEmail,
                State: oState,//$scope.ngState,
                Postcode: oPostcode,
                Reporting: oReporting,
                UserLevel: oUserLevel,
                Password: oPassword

            }
            EmployeeFactory.PostServiceCall(urlpro + '/SaveCWRData1/', CWRData).then(function (response) {
                $scope.SusMessage = "Data has been Saved successfully";
                $scope.alertsuccess = false;
            });
        }

    }

    function CheckUsernamesAvailability() {

        var Username = { Username: $scope.ngUsername }

        EmployeeFactory.PostServiceCall(urlpro + '/CheckUsernamesAvailability/', Username).then(function (response) {
            debugger;
            if (response.data[0] == "T") {
                return false;
            }
            else {
                $scope.FailMessage = "User Name already Availabile!!! ";
                $scope.alertdanger = false;
                return true;
            }
        });

    }






    //function myFunction() {
    //    setTimeout(function () { $scope.alertsuccess = true; }, 3000);
    //}
    $scope.TS_Getsavedcwrdetailes = function () {

        $scope.savedcwrdetailes = [];
        EmployeeFactory.PostServiceCall(urlpro + '/GetSavedCWRDetailes/').then(function (response) {

            for (i = 0; i < response.data.length; ++i) {
                $scope.savedcwrdetailes.push(response.data[i]);
            }
        });
    };

    $scope.rebindingcwrdata = function (username) {
        var Requsername = { username: username }
        EmployeeFactory.PostServiceCall(urlpro + '/FetchDataBasedOnUserName/', Requsername).then(function (response) {

            debugger;
            $scope.ngUsername = response.data[0].Username;
            $scope.ngName = response.data[0].Name;
            $scope.ngJoiningDate = response.data[0].JoiningDate;
            $scope.ngFatherName = response.data[0].FatherName;
            $scope.ngDOB = response.data[0].DOB;
            $scope.ngAddress = response.data[0].Address;
            $scope.ngMobileNo = response.data[0].MobileNo;
            $scope.ngGender = response.data[0].Gender;
            $scope.ngEmail = response.data[0].Email;
            $scope.ngPostcode = response.data[0].Postcode;
            $scope.ngReporting = response.data[0].Reporting;
            $scope.ngUserLevel = response.data[0].UserLevel;
            $scope.ngPassword = response.data[0].Password;
            $scope.ngState = response.data[0].State;
            $scope.ngPosition = response.data[0].Position;

        });
    }





}]);



EmployeeModule.directive("datepicker1", function () {
    return {
        restrict: "A",
        require: "ngModel",
        link: function (scope, elem, attrs, ngModelCtrl) {
            var updateModel = function (dateText) {
            };
            var options = {
                changeMonth: true,
                changeYear: true,
                dateFormat: "dd/mm/yy",
                onClose: function (dateText, inst) {
                    $(this).datepicker('setDate', new Date(inst.selectedYear, inst.selectedMonth, 1));

                },
                // handle jquery date change
                onSelect: function (dateText) {
                    updateModel(dateText);
                }
            };
            // jqueryfy the element
            $(elem).datepicker(options);
        }
    }
});
EmployeeModule.directive("datepicker", function () {
    return {
        restrict: "A",
        require: "ngModel",
        link: function (scope, elem, attrs, ngModelCtrl) {
            var updateModel = function (dateText) {
            };

            var options = {
                changeMonth: true,
                changeYear: true,
                dateFormat: "dd/mm/yy",
                onClose: function (dateText, inst) {
                    $(this).datepicker('setDate', new Date(inst.selectedYear, inst.selectedMonth, 1));

                },
                // handle jquery date change
                onSelect: function (dateText) {

                    updateModel(dateText);

                }
            };
            $(elem).datepicker(options);
        }
    }
});

EmployeeModule.directive('numbersOnly', function () {
    return {
        require: 'ngModel',
        link: function (scope, element, attr, ngModelCtrl) {
            function fromUser(text) {
                if (text) {
                    var transformedInput = text.replace(/[^0-9-]/g, '');
                    if (transformedInput !== text) {
                        ngModelCtrl.$setViewValue(transformedInput);
                        ngModelCtrl.$render();
                    }
                    return transformedInput;
                }
                return undefined;
            }
            ngModelCtrl.$parsers.push(fromUser);
        }
    };
});



