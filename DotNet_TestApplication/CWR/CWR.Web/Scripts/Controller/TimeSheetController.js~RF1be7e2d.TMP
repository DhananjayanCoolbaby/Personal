


EmployeeModule.controller("TimeSheetController", ["$scope", "$http", "EmployeeFactory", function ($scope, $http, EmployeeFactory) {

    $scope.FetchDateDetails = [];
    EmployeeFactory.PostServiceCall(urlpro + '/FetchDateDetails/').then(function (response) {
        debugger;
        for (i = 0; i < response.data.length; ++i) {
            $scope.FetchDateDetails.push(response.data[i]);
            //$scope.ddlSelectVal = $scope.FetchDateDetails[i].ProjectHoursWorked;
        }
    });
    $scope.FetchLegendDetails = [];
    EmployeeFactory.PostServiceCall(urlpro + '/FetchLegendDetails/').then(function (response) {
        for (i = 0; i < response.data.length; ++i) {
            $scope.FetchLegendDetails.push(response.data[i]);
        }
    });

    $scope.TS_GetSavedTimeSheetDetailes = function () {
        $scope.SavedTimeSheetDetailes = [];
        EmployeeFactory.PostServiceCall(urlpro + '/GetSavedTimeSheetDetailes/').then(function (response) {
            debugger;
            for (i = 0; i < response.data.length; ++i) {
                $scope.SavedTimeSheetDetailes.push(response.data[i]);
            }
        });
    };



    var pocvalListsave = $scope.Poclist;

    $scope.SubmitTimeSheet = function () {
        debugger;
        $scope.tempSaveArray = [];
        var lentextbox = $scope.FetchDateDetails.length;
        for (var i = 0; i < lentextbox; i++) {
            var strval = $scope.FetchDateDetails[i].Date;
            var txtboxval = $('#timeval_' + strval).val();
            var dateval = $('#date_' + strval).data("date");
            var TimeSheetID = $('#date_' + strval).data("timesheetperiodid");
            var timeSheetdata = {
                DateWorked: dateval,
                ProjectHoursWorked: txtboxval,
                TimesheetPeriodid: TimeSheetID
            }
            $scope.tempSaveArray.push(timeSheetdata);
        }
        var TimeSheetarray = $scope.tempSaveArray;
        EmployeeFactory.PostServiceCall(urlpro + '/SaveTimeSheetDetails/', TimeSheetarray).then(function (response) {
        });


    }
    $scope.TimeList = [];
    $scope.SaveTime = function (date) {
        debugger;
        var txtboxval = $('#timeval_' + date).val();

        var dateval = $('#date_' + date).data("date");
        var TimeSheetID = $('#date_' + date).data("timesheetperiodid");

        // var date = dateval.split("-");
        var TimeSavedata = {
            Date: dateval,
            ProjectHoursWorked: txtboxval,
            TimesheetPeriodid: TimeSheetID
        }
        EmployeeFactory.PostServiceCall(urlpro + '/SavedaybydateTime/', TimeSavedata).then(function (response) {

        });
    }

    $scope.RebindingTimeSheetData = function (RequestId) {
        var ReqID = { RequestId: RequestId }
        EmployeeFactory.PostServiceCall(urlpro + '/FetchDataBasedOnRequestId/', ReqID).then(function (response) {
            debugger;
            $scope.FetchDateDetails.length = 0;
            for (i = 0; i < response.data.length; ++i) {

                $scope.FetchDateDetails.push(response.data[i]);

            }
        });
    }

    $scope.PickDataBasedOnDate = function (date) {
        alert(12);
    }



}]);



EmployeeModule.directive("datepicker", function () {
    debugger;
    return {
        restrict: "A",
        require: "ngModel",
        link: function (scope, elem, attrs, ngModelCtrl) {
            var updateModel = function (dateText) {

                var a = $('#start_date').val().split('/');
                var b = dateText.split('/');
                if ($('#start_date').val() != "") {
                    if (new Date(a[2], a[1], a[0]) < new Date(b[2], b[1], b[0])) {
                        $('#start_date').val("");
                    }
                    else {

                    }
                }
            };

            var options = {
                dateFormat: "dd/mm/yy",
                maxDate: new Date(),
                beforeShowDay: $.datepicker.noWeekends,
                onSelect: function (dateText) {
                    updateModel(dateText);
                }

            };

            $(elem).datepicker({ beforeShowDay: isAvailable, maxDate: new Date(), dateFormat: "dd/mm/yy", });
        }
    }
});

function isAvailable(date) {
    var dt = date.getDate();
    if (dt == 1 || dt == 16) {
        return [true, "", ""];
    } else {
        return [false, "", ""];
    }
}





